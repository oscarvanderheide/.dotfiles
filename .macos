#!/usr/bin/env bash

# References:
# https://mac.install.guide/mac-setup/
# https://medium.com/@laclementine/dotfile-for-mac-efe082ad0d6a
# https://github.com/mathiasbynens/dotfiles/blob/main/.macos

# Close any open System Preferences panes, to prevent them from overriding
# settings we’re about to change
osascript -e 'tell application "System Preferences" to quit'

# Ask for the administrator password upfront
sudo -v

# Keep-alive: update existing `sudo` time stamp until `.macos` has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

############
# GENERAL #
############

# Disable the sound effects on boot
sudo nvram SystemAudioVolume=" "

# Automatically quit printer app once the print jobs complete
defaults write com.apple.print.PrintingPrefs "Quit When Finished" -bool true

# Remove duplicates in the “Open With” menu (also see `lscleanup` alias)
/System/Library/Frameworks/CoreServices.framework/Frameworks/LaunchServices.framework/Support/lsregister -kill -r -domain local -domain system -domain user

# Reveal IP address, hostname, OS version, etc. when clicking the clock
# in the login window
sudo defaults write /Library/Preferences/com.apple.loginwindow AdminHostInfo HostName

# Disable automatic capitalization as it’s annoying when typing code
defaults write NSGlobalDomain NSAutomaticCapitalizationEnabled -bool false

# Disable smart dashes as they’re annoying when typing code
defaults write NSGlobalDomain NSAutomaticDashSubstitutionEnabled -bool false

# Disable automatic period substitution as it’s annoying when typing code
defaults write NSGlobalDomain NSAutomaticPeriodSubstitutionEnabled -bool false

# Disable smart quotes as they’re annoying when typing code
defaults write NSGlobalDomain NSAutomaticQuoteSubstitutionEnabled -bool false

# Disable auto-correct
defaults write NSGlobalDomain NSAutomaticSpellingCorrectionEnabled -bool false

###############################################################
# Trackpad, mouse, keyboard, Bluetooth accessories, and input #
###############################################################

# Trackpad: enable tap to click for this user and for the login screen
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad Clicking -bool true
defaults -currentHost write NSGlobalDomain com.apple.mouse.tapBehavior -int 1
defaults write NSGlobalDomain com.apple.mouse.tapBehavior -int 1

# Increase sound quality for Bluetooth headphones/headsets
defaults write com.apple.BluetoothAudioAgent "Apple Bitpool Min (editable)" -int 40

# Disable press-and-hold for keys in favor of key repeat
defaults write -g ApplePressAndHoldEnabled -bool false

# Set a blazingly fast keyboard repeat rate
defaults write NSGlobalDomain KeyRepeat -int 6
defaults write NSGlobalDomain InitialKeyRepeat -int 25

##########
# SCREEN #
##########

# Require password immediately after sleep or screen saver begins
defaults write com.apple.screensaver askForPassword -int 1
defaults write com.apple.screensaver askForPasswordDelay -int 0

# Save screenshots to the desktop
defaults write com.apple.screencapture location -string "${HOME}/Desktop"

# Save screenshots in PNG format (other options: BMP, GIF, JPG, PDF, TIFF)
defaults write com.apple.screencapture type -string "png"

# Disable shadow in screenshots
defaults write com.apple.screencapture disable-shadow -bool true

# Enable subpixel font rendering on non-Apple LCDs
# Reference: https://github.com/kevinSuttle/macOS-Defaults/issues/17#issuecomment-266633501
defaults write NSGlobalDomain AppleFontSmoothing -int 1

# Enable HiDPI display modes (requires restart)
sudo defaults write /Library/Preferences/com.apple.windowserver DisplayResolutionEnabled -bool true

############
# MENU BAR #
############

# Show battery percentage
defaults -currentHost write com.apple.controlcenter BatteryShowPercentage -bool true

##########
# FINDER #
##########

# Finder: allow quitting via ⌘ + Q; doing so will also hide desktop icons
defaults write com.apple.finder QuitMenuItem -bool true

# Use list view
defaults write com.apple.finder FXPreferredViewStyle -string "Nlsv"

# Show path bar
defaults write com.apple.finder ShowPathbar -bool true

# Show status bar
defaults write com.apple.finder ShowStatusBar -bool true

# Show hidden files
defaults write com.apple.finder AppleShowAllFiles true

# Show filename extensions
defaults write NSGlobalDomain AppleShowAllExtensions -bool true

# Search the current folder by default
defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"

# Keep folders on top when sorting by name
defaults write com.apple.finder _FXSortFoldersFirst -bool true

# Disable the warning when changing a file extension
defaults write com.apple.finder FXEnableExtensionChangeWarning -bool false

# Always show scrollbars. Possible values: `WhenScrolling`, `Automatic` and `Always`
defaults write NSGlobalDomain AppleShowScrollBars -string "Always"

# Expand print panel by default
defaults write NSGlobalDomain PMPrintingExpandedStateForPrint -bool true
defaults write NSGlobalDomain PMPrintingExpandedStateForPrint2 -bool true

# Avoid creating .DS_Store files on network or USB volumes
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true

# Enable spring loading for directories
defaults write NSGlobalDomain com.apple.springing.enabled -bool true

# Remove the spring loading delay for directories
defaults write NSGlobalDomain com.apple.springing.delay -float 0

# Disable disk image verification
defaults write com.apple.frameworks.diskimages skip-verify -bool true
defaults write com.apple.frameworks.diskimages skip-verify-locked -bool true
defaults write com.apple.frameworks.diskimages skip-verify-remote -bool true

# Automatically open a new Finder window when a volume is mounted
defaults write com.apple.frameworks.diskimages auto-open-ro-root -bool true
defaults write com.apple.frameworks.diskimages auto-open-rw-root -bool true
defaults write com.apple.finder OpenWindowForNewRemovableDisk -bool true

###################
# SYSTEM SETTINGS #
###################

# Beep feedback when changing volume
defaults write NSGlobalDomain com.apple.sound.beep.feedback -integer 1

# Beep feedback when plugging in the power adapter
defaults write com.apple.PowerChime ChimeOnAllHardware -bool true

# Enable automatic updates
sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate.plist AutomaticallyInstallMacOSUpdates -bool true
sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate.plist AutomaticCheckEnabled -bool true
sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate.plist AutomaticDownload -bool true
sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate.plist CriticalUpdateInstall -bool true
sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate.plist ConfigDataInstall -bool true
sudo defaults write /Library/Preferences/com.apple.commerce.plist AutoUpdate -bool true

# Startup Chime / StartupMute=%01 to mute
sudo nvram StartupMute=%00

# Activity Monitor : Show Data in graph instead of IO and packets
sudo defaults write com.apple.ActivityMonitor DiskGraphType -int 1
sudo defaults write com.apple.ActivityMonitor NetworkGraphType -int 1

# Enable highlight hover effect for the grid view of a stack (Dock)
defaults write com.apple.dock mouse-over-hilite-stack -bool true

# Enable spring loading for all Dock items
defaults write com.apple.dock enable-spring-load-actions-on-all-items -bool true

# Show indicator lights for open applications in the Dock
defaults write com.apple.dock show-process-indicators -bool true



# Remove the animation when hiding/showing the Dock
defaults write com.apple.dock autohide-time-modifier -float 0.5; killall Dock

# Automatically hide and show the Dock
defaults write com.apple.dock autohide -bool true

# Make Dock icons of hidden applications translucent
defaults write com.apple.dock showhidden -bool true



#####################
# TRACKPAD SETTINGS #
#####################

# Swipe between pages with three fingers
defaults write com.apple.AppleMultitouchTrackpad TrackpadThreeFingerHorizSwipeGesture -int 1

# Swipe between full-screen applications with four fingers
defaults write com.apple.AppleMultitouchTrackpad TrackpadFourFingerHorizSwipeGesture -int 2

# Enable Notification Centre gesture (two fingers from right edge)
defaults write com.apple.AppleMultitouchTrackpad TrackpadTwoFingerFromRightEdgeSwipeGesture -int 3

# Disable Mission Control gesture
defaults write com.apple.AppleMultitouchTrackpad TrackpadFourFingerVertSwipeGesture -int 0

# Disable App Exposé gesture
defaults write com.apple.AppleMultitouchTrackpad TrackpadThreeFingerVertSwipeGesture -int 0

# Disable Launchpad pinch gesture
defaults write com.apple.dock showLaunchpadGestureEnabled -bool false

# Disable Show Desktop spread gesture
defaults write com.apple.AppleMultitouchTrackpad TrackpadFiveFingerPinchGesture -int 1

# Apply changes
killall Dock
killall SystemUIServer





#################
# DOCK SETTINGS #
#################

# Don’t show recent applications in Dock
defaults write com.apple.dock "show-recents" -bool "false"

# Autohide dock
defaults write com.apple.dock "autohide" -bool "true"

# Move dock to the right
defaults write com.apple.dock "orientation" -string "right"

# Reduce size of icons
defaults write com.apple.dock "tilesize" -int "16"

# Only show active apps 
defaults write com.apple.dock "static-only" -bool "true"

# Remove the auto-hiding Dock delay
defaults write com.apple.dock "autohide-delay" -float "0"

#######################
# SCREENSHOT SETTINGS #
#######################

# Disable shadows
defaults write com.apple.screencapture "disable-shadow" -bool "false"

###################
# FINDER SETTINGS #
###################

# Show extensions
defaults write NSGlobalDomain "AppleShowAllExtensions" -bool "true"

# Default to list view
defaults write com.apple.finder "FXPreferredViewStyle" -string "Nlsv"

# Keep folders on top
defaults write com.apple.finder "_FXSortFoldersFirst" -bool "true"

# Search in current folder instead of entire mac
defaults write com.apple.finder "FXDefaultSearchScope" -string "SCcf"

# Don't use iCloud as default directory when saving files
defaults write NSGlobalDomain "NSDocumentSaveNewDocumentsToCloud"

###################
# DESKTOP SETTING #
###################

# Hide all icons
defaults write com.apple.finder "CreateDesktop" -bool "false"

# Hide hard disks
defaults write com.apple.finder "ShowHardDrivesOnDesktop" -bool "false"

# Hide external disks
defaults write com.apple.finder "ShowExternalHardDrivesOnDesktop" -bool "false"

#####################
# TEXTEDIT SETTINGS #
#####################

# Plain text mode in TextEdit
defaults write com.apple.TextEdit "RichText" -bool "false"

# Disable smart quotes
defaults write com.apple.TextEdit "SmartQuotes" -bool "false" 
